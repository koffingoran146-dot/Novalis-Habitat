<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>NovalisHabitat.CI</title>
  <meta name="theme-color" content="#ff7f00"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js" defer></script>
  <style>
    :root{--orange:#ff7f00;--green:#10b981;--greenPure:#009e60;--greenBadgeBg:#bbf7d0;--txt:#0f172a;--muted:#6b7280;--bd:#e5e7eb;--bg:#FFF4E6}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--txt)}
    a{color:#0ea5e9;text-decoration:none}
    .header{position:sticky;top:0;z-index:60;background:#fff;border-bottom:1px solid var(--bd)}
    .container{max-width:1200px;margin:0 auto;padding:12px 16px}
    .toolbar{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .brand{font-weight:900;display:flex;align-items:center;gap:6px;cursor:pointer}
    .dot{position:relative;width:12px;height:12px;border-radius:999px;display:inline-block;margin-left:6px}
    .o{background:#ff7f00}.w{background:#e5e7eb;border:1px solid #d1d5db}.g{background:#10b981}
    .count{position:absolute;top:-10px;right:-12px;background:#0f1530;color:#fff;border-radius:999px;padding:0 6px;font-size:10px;line-height:16px;min-width:18px;text-align:center}
    .spacer{flex:1}
    .btn{border:1px solid var(--bd);border-radius:12px;padding:8px 12px;background:#fff;cursor:pointer;font-weight:600}
    .btn:hover{transform:translateY(-1px)}
    .btn.install{background:var(--orange);border-color:var(--orange);color:#fff}
    .pill{border:1px solid var(--bd);border-radius:999px;padding:6px 12px;background:#fff;cursor:pointer}
    .pill.active{background:var(--green);color:#fff;border-color:transparent}
    input,select,textarea{border:1px solid var(--bd);border-radius:12px;padding:8px 12px;background:#fff;font-size:14px}
    select.compact{padding:6px 10px;height:36px}
    textarea{min-height:80px;resize:vertical}
    .muted{color:var(--muted)}
    #fiche{max-width:1100px;margin:14px auto 0;padding:16px;border:1px solid #111a38;border-radius:14px;background:#0f1530;color:#e9eefb;display:none}
    #pdf-bar{max-width:1100px;margin:8px auto 0;display:none;gap:8px}
    #alert-login{position:fixed;left:16px;bottom:16px;background:#0f1530;color:#e9eefb;border:1px solid #111a38;border-radius:12px;padding:8px 12px;z-index:40;display:none}
    /* GPS masquÃ© par dÃ©faut */
    #map{max-width:1200px;margin:16px auto;border:1px solid var(--bd);border-radius:12px;background:#fff;padding:10px;display:none}
    #leaf{height:520px;border-radius:12px;overflow:hidden}
    .grid{max-width:1200px;margin:0 auto 80px;display:grid;gap:16px}
    @media(min-width:640px){.grid{grid-template-columns:repeat(2,minmax(0,1fr))}}
    @media(min-width:1024px){.grid{grid-template-columns:repeat(3,minmax(0,1fr))}}
    .card{border:1px solid var(--bd);border-radius:16px;overflow:hidden;background:#fff;box-shadow:0 1px 2px rgba(0,0,0,.04)}
    .cover-box{width:100%;aspect-ratio:16/9;background:#e5e7eb;position:relative;overflow:hidden}
    .cover{width:100%;height:100%;object-fit:cover;display:block}
    .inner{padding:12px}
    .badge{display:inline-flex;border:1px solid var(--bd);border-radius:999px;padding:2px 8px;font-size:12px;gap:6px}
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;padding:10px;z-index:65}
    .modal.open{display:flex}
    .overlay{position:absolute;inset:0;background:rgba(0,0,0,.45)}
    .dialog{position:relative;z-index:1;background:#fff;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.15);max-width:980px;width:100%;max-height:92vh;display:flex;flex-direction:column}
    .dialog .head{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--bd);padding:12px}
    .dialog .body{padding:12px;overflow:auto}
    .dialog .grid2{display:grid;gap:10px;grid-template-columns:1fr}
    @media(min-width:640px){.dialog .grid2{grid-template-columns:1fr 1fr}}
    .account-wrap{position:relative}
    .popover{position:absolute;right:0;top:calc(100% + 6px);background:#fff;border:1px solid var(--bd);border-radius:12px;padding:12px;box-shadow:0 10px 30px rgba(0,0,0,.12);width:320px;display:none;z-index:70}
    .popover.open{display:block}
    .pop-title{font-weight:700;margin-bottom:6px}
    .pop-row{display:flex;gap:8px;align-items:center}
    .pop-actions{display:flex;gap:8px;justify-content:flex-end;margin-top:8px}
    footer{position:fixed;left:0;right:0;bottom:0;background:#fff;border-top:1px solid var(--bd);z-index:10}
    .foot{max-width:1200px;margin:0 auto;display:flex;gap:12px;align-items:center;padding:10px}
    .foot-center{margin-left:auto;color:#334155;font-weight:600}
    #bot-button{position:fixed;right:16px;bottom:86px;width:56px;height:56px;border-radius:999px;background:linear-gradient(135deg,#ff7f00,#10b981);display:flex;align-items:center;justify-content:center;color:#fff;font-size:26px;border:none;box-shadow:0 12px 28px rgba(0,0,0,.22);cursor:pointer;z-index:9999}
    #bot-panel{position:fixed;right:16px;bottom:150px;width:360px;max-width:95vw;max-height:70vh;background:#fff;border:1px solid var(--bd);border-radius:16px;box-shadow:0 14px 40px rgba(0,0,0,.22);display:none;flex-direction:column;overflow:hidden;z-index:9999}
    #bot-panel.open{display:flex}
    .bot-head{padding:10px 12px;border-bottom:1px solid var(--bd);display:flex;justify-content:space-between;align-items:center}
    .bot-body{padding:12px;overflow:auto;flex:1}
    .bot-msg{margin-bottom:10px}
    .bot-msg.me{text-align:right}
    .bot-msg .bubble{display:inline-block;padding:8px 10px;border-radius:12px;border:1px solid var(--bd);background:#fff;max-width:87%}
    .bot-msg.me .bubble{background:#0f1530;color:#e9eefb;border-color:#111a38}
    .bot-input{display:flex;gap:8px;border-top:1px solid var(--bd);padding:10px}
    .chips{display:flex;flex-wrap:wrap;gap:6px;margin-top:6px}
    .chip{border:1px solid var(--bd);border-radius:999px;padding:6px 10px;background:#fff;cursor:pointer;font-size:13px}
  </style>
</head>
<body>
  <div id="alert-login">Connexion requise</div>

  <div id="pdf-bar" class="container">
    <button id="btnPdf" class="btn">TÃ©lÃ©charger ma fiche (PDF)</button>
  </div>
  <section id="fiche">
    <h2>Ma fiche</h2>
    <p>Nom : <span id="fiche-nom">-</span></p>
    <p>Email : <span id="fiche-email">-</span></p>
  </section>

  <div class="header">
    <div class="container toolbar">
      <div id="brand" class="brand" title="Accueil">
        <span style="color:#ff7f00">Novalis</span><span style="color:#0f172a">Habitat</span><span style="color:#10b981">.CI</span>
        <span class="dot o" title="Annonces"><span id="n-orange" class="count">0</span></span>
        <span class="dot w" title="Vues"><span id="n-white" class="count">0</span></span>
        <span class="dot g" title="Favoris"><span id="n-green" class="count">0</span></span>
      </div>
      <div class="spacer"></div>

      <!-- SÃ©lecteur regroupÃ© des types de biens (avant Explorer) -->
      <select id="kind-filter" class="compact" title="Maisons / Appartements">
        <option value="">Biens : Tous</option>
        <option value="appartement">Appartements</option>
        <option value="maison">Maisons</option>
        <option value="villa">Villas</option>
        <option value="studio">Studios</option>
        <option value="terrain">Terrains</option>
        <option value="bureau">Bureaux</option>
        <option value="duplex">Duplex</option>
        <option value="immeuble">Immeubles</option>
        <option value="hÃ´tel">HÃ´tels</option>
        <option value="hotel">HÃ´tels (alt)</option>
        <option value="jardin">Jardin</option>
      </select>

      <button id="btn-explore" class="btn">Explorer</button>
      <button id="btn-gps" class="btn">Localisation</button>
      <button id="btn-abonnement" class="btn">Inscription</button>
      <button id="btn-install" class="btn install">Installer</button>
      <button id="btn-dash" class="btn">Tableau de bord</button>

      <div class="account-wrap">
        <button id="btn-account" class="btn">Compte</button>
        <div id="login-pop" class="popover">
          <div class="pop-title">Connexion</div>
          <div class="pop-row"><input id="nh-email" type="email" placeholder="Email"/></div>
          <div class="pop-row"><input id="nh-password" type="password" placeholder="Mot de passe"/></div>
          <div class="pop-actions">
            <button class="btn" id="btn-pop-in">Se connecter</button>
            <button class="btn install" id="btn-pop-up">CrÃ©er un compte</button>
          </div>
          <div id="after-login" style="display:none">
            <div class="muted" style="margin-top:6px">ConnectÃ© : <b id="nh-who"></b></div>
            <div class="pop-actions" style="justify-content:flex-start;margin-top:6px">
              <button class="btn" id="btn-pop-pdf">Imprimer ma fiche</button>
              <button class="btn" id="btn-pop-out">Se dÃ©connecter</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="container toolbar" style="margin-top:12px">
    <button class="pill active" data-mode="all">Tout</button>
    <button class="pill" data-mode="vente">Ã€ vendre</button>
    <button class="pill" data-mode="location">Ã€ louer</button>

    <select id="city-filter"><option value="">Ville</option></select>
    <select id="district-filter" disabled><option value="">Quartier</option></select>

    <input type="number" id="max-price" placeholder="Budget max (FCFA)" min="0"/>
    <button id="apply-filters" class="btn">Filtrer</button>
    <button id="btn-near-filter" class="btn">PrÃ¨s de moi</button>
    <select id="bedrooms">
      <option value="">Chambres (min)</option><option value="0">Studio</option><option value="1">1+</option><option value="2">2+</option><option value="3">3+</option><option value="4">4+</option>
    </select>

    <span class="spacer"></span>
    <input id="search" placeholder="Rechercherâ€¦" style="min-width:220px"/>
    <button id="btn-search" class="btn">Rechercher</button>
    <select id="sort-by"><option value="recent">Tri: RÃ©cent</option><option value="price-asc">Tri: Prix â†‘</option><option value="price-desc">Tri: Prix â†“</option><option value="area">Tri: Surface</option></select>
    <button id="btn-publish" class="btn">CrÃ©er une annonce</button>
  </div>

  <!-- SECTION CARTE (masquÃ©e par dÃ©faut) -->
  <section id="map" class="container">
    <div style="font-weight:700;margin-bottom:6px">Carte & GPS â€” CÃ´te dâ€™Ivoire</div>
    <div class="toolbar" style="gap:8px;margin:8px 0">
      <button id="btn-ci" class="btn">Vue CÃ´te dâ€™Ivoire</button>
      <button id="btn-near" class="btn">Autour de moi</button>
      <button id="btn-hide-map" class="btn">Masquer la carte</button>
    </div>
    <div id="leaf"></div>
  </section>

  <main class="container">
    <div id="grid" class="grid" style="padding-bottom:60px"></div>
    <div id="empty" class="muted" style="text-align:center;padding:48px 0;display:none">Aucun rÃ©sultat. <button class="btn" id="reset-filters">RÃ©initialiser</button> âœ¨</div>
  </main>
  <div id="modal" class="modal">
    <div class="overlay" id="overlay"></div>
    <div class="dialog">
      <div class="head toolbar" style="justify-content:space-between">
        <div style="font-weight:700" id="m-title"></div>
        <div class="toolbar">
          <button class="btn" id="m-share">Partager</button>
          <button class="btn" id="m-fav">â˜† Favori</button>
          <button class="btn" id="m-close">Fermer</button>
        </div>
      </div>
      <div class="body">
        <div id="m-geo" class="muted"></div>
        <div id="m-specs" class="muted"></div>
        <div style="font-size:18px;font-weight:700" id="m-price"></div>
        <p id="m-desc" class="muted"></p>

        <div style="margin-top:10px;padding-top:10px;border-top:1px solid var(--bd)">
          <div style="font-weight:700;margin-bottom:6px">Contacter le propriÃ©taire</div>
          <textarea id="m-msg" placeholder="Je suis intÃ©ressÃ©." style="margin-bottom:8px">Je suis intÃ©ressÃ©.</textarea>
          <div class="toolbar">
            <button class="btn" id="m-msg-wa">Envoyer via WhatsApp</button>
            <button class="btn" id="m-msg-mail">Envoyer par e-mail</button>
            <button class="btn install" id="m-msg-site">Message privÃ© (site)</button>
            <button class="btn" id="m-devis-wa" style="display:none">Demander un devis (WhatsApp)</button>
          </div>
          <div class="muted" id="m-contact-hint"></div>
        </div>
      </div>
    </div>
  </div>

  <div id="insc-modal" class="modal">
    <div class="overlay" data-close="#insc-modal"></div>
    <div class="dialog">
      <div class="head">
        <div class="toolbar" style="justify-content:space-between">
          <strong>Inscription</strong>
          <button class="btn" data-close="#insc-modal">Fermer</button>
        </div>
      </div>
      <div class="body">
        <form id="insc-form" class="grid2">
          <div><label>Nom</label><input id="f-nom" required/></div>
          <div><label>PrÃ©nom</label><input id="f-prenom" required/></div>
          <div><label>Date de naissance</label><input id="f-dnaiss" type="date" required/></div>
          <div><label>Lieu de naissance</label><input id="f-lnaiss" required/></div>
          <div class="grid2" style="grid-template-columns:2fr 1fr">
            <div><label>Adresse</label><input id="f-adresse"/></div>
            <div><label>Titre / Fonction</label><input id="f-titre" placeholder="Ã‰tudiant, Particulier, Clientâ€¦"/></div>
          </div>
          <div class="grid2" style="grid-template-columns:2fr 1fr">
            <div><label>Email (identifiant)</label><input id="f-email" type="email" required/></div>
            <div><label>Mot de passe</label><input id="f-pass" type="password" minlength="6" required/></div>
          </div>
          <div>
            <label>Statut</label>
            <select id="f-statut" required>
              <option value="">â€” Choisir â€”</option>
              <option>Ã‰tudiant</option><option>Particulier</option><option>Client</option>
            </select>
          </div>
          <div><button class="btn install" type="submit">CrÃ©er mon compte</button></div>
        </form>
      </div>
    </div>
  </div>

  <div id="pub-modal" class="modal">
    <div class="overlay" data-close="#pub-modal"></div>
    <div class="dialog">
      <div class="head">
        <div class="toolbar" style="justify-content:space-between">
          <strong>CrÃ©er une annonce</strong>
          <button class="btn" data-close="#pub-modal">Fermer</button>
        </div>
      </div>
      <div class="body">
        <form id="pub-form" class="grid2">
          <div><label>Titre</label><input id="p-title" required/></div>
          <div><label>Type</label><select id="p-type"><option value="vente">Vente</option><option value="location">Location</option></select></div>
          <div><label>CatÃ©gorie</label><select id="p-kind"><option>villa</option><option>appartement</option><option>studio</option><option>terrain</option><option>hÃ´tel</option><option>bureau</option><option>maison</option><option>duplex</option><option>immeuble</option><option>jardin</option></select></div>
          <div><label>Prix (FCFA)</label><input id="p-price" type="number" min="0" required/></div>
          <div><label>Ville</label><select id="p-city"></select></div>
          <div>
            <label>Quartier</label>
            <div style="display:flex;gap:8px">
              <select id="p-district" style="flex:1"></select>
              <button class="btn" type="button" id="p-add-district">+ Autre</button>
            </div>
            <input id="p-district-new" placeholder="Nouveau quartierâ€¦" style="display:none;margin-top:6px"/>
          </div>
          <div class="grid2">
            <div><label>Chambres</label><input id="p-bed" type="number" min="0" value="0"/></div>
            <div><label>Salles dâ€™eau</label><input id="p-bath" type="number" min="0" value="0"/></div>
          </div>
          <div><label>Surface (mÂ²)</label><input id="p-area" type="number" min="0" value="0"/></div>
          <div><label>Description</label><textarea id="p-desc" placeholder="DÃ©tails, proximitÃ©, commoditÃ©sâ€¦"></textarea></div>
          <div class="grid2">
            <div class="grid2">
              <div><label>Latitude</label><input id="p-lat" type="number" step="any"/></div>
              <div><label>Longitude</label><input id="p-lng" type="number" step="any"/></div>
            </div>
            <div><label>Contact WhatsApp (E.164)</label><input id="p-whats" placeholder="+2250500000000"/></div>
          </div>
          <div><label>Contact Email</label><input id="p-email" type="email" placeholder="ex: proprietaire@exemple.com"/></div>
          <div><button class="btn install" type="submit">Publier</button> <button class="btn" type="button" id="p-use-gps">Utiliser ma position</button></div>
        </form>
      </div>
    </div>
  </div>

  <!-- Bot -->
  <button id="bot-button" title="Assistant">ðŸ’¬</button>
  <div id="bot-panel" aria-live="polite">
    <div class="bot-head">
      <strong>Assistant NovalisHabitat</strong>
      <button class="btn" id="bot-close">Fermer</button>
    </div>
    <div class="bot-body" id="bot-body"></div>
    <div class="bot-input">
      <input id="bot-text" placeholder="Posez votre questionâ€¦"/>
      <button class="btn" id="bot-send">Envoyer</button>
    </div>
  </div>

  <footer>
    <div class="foot">
      <a href="#" id="f-explore" class="link">Explorer</a> |
      <a href="#" id="f-gps" class="link">Localisation</a> |
      <a href="#" id="f-contact" class="link">Contact</a>
      <div class="foot-center">Â© 2025 NovalisHabitat.CI â€” Abidjan, CÃ´te dâ€™Ivoire</div>
    </div>
  </footer>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

    // â€”â€”â€”â€”â€” RENSEIGNE ICI TES VALEURS â€”â€”â€”â€”â€”
    const SUPABASE_URL  = "https://TON-PROJET.supabase.co";
    const SUPABASE_ANON = "ta_cle_anon_publique";
    const ADMIN_PHONE_E164 = "+2250700435569"; // numÃ©ro principal
    const ADMIN_EMAIL      = "claudbrou01@gmail.com"; // email contact
    // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”

    // === AJOUT: PAYSAGISTE / JARDIN ===
    const ADMIN_PAYSAGISTE_NAME  = "Les Fleurs dâ€™Eden";
    const ADMIN_PAYSAGISTE_PHONE = "+2250700435569";
    const ADMIN_PAYSAGISTE_EMAIL = "claudbrou01@gmail.com";
    // ==================================

    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON);

    const $=(s,r=document)=>r.querySelector(s), qsa=(s,r=document)=>Array.from(r.querySelectorAll(s)), fmt=n=>(n||0).toLocaleString("fr-FR");
    const LS_LISTINGS="nh:listings", LS_FAVS="nh:favs", LS_PENDING_PROFILE="nh:pending-profile", LS_MSG="nh:messages", LS_VIEWS="nh:views", LS_DIST="nh:custom-districts";

    const REAL={
      villa:["https://source.unsplash.com/1024x640/?villa,house,modern,africa&sig=11"],
      appartement:["https://source.unsplash.com/1024x640/?apartment,interior&sig=21"],
      hotel:["https://source.unsplash.com/1024x640/?hotel,lagoon,water&sig=31"],
      studio:["https://source.unsplash.com/1024x640/?studio,apartment,small&sig=41"],
      terrain:["https://source.unsplash.com/1024x640/?land,plot,field,africa&sig=51"],
      jardin:["https://source.unsplash.com/1024x640/?garden,landscape,plants,africa&sig=61"]
    };

    // Exemple de donnÃ©es initiales
    const SAMPLE=[
      {id:"P-JARDIN",title:`Paysagiste â€” ${ADMIN_PAYSAGISTE_NAME}`,type:"location",kind:"jardin",price:0,city:"Abidjan",district:"Cocody",bedrooms:0,bathrooms:0,area:0,lat:5.356,lng:-3.990,photos:REAL.jardin,created_at:"2025-07-15T09:30:00Z",contact_phone:ADMIN_PAYSAGISTE_PHONE,contact_email:ADMIN_PAYSAGISTE_EMAIL}
    ];

    function db_get(k,def){try{return JSON.parse(localStorage.getItem(k))??def}catch{ return def }}
    function db_set(k,v){localStorage.setItem(k,JSON.stringify(v))}

    // ==================== Rendu des annonces ====================
    function render(){
      const grid=$("#grid"), empty=$("#empty");
      grid.innerHTML="";
      const list=db_get(LS_LISTINGS,SAMPLE);
      list.forEach(p=>{
        const card=document.createElement("div"); card.className="card";
        const cover=document.createElement("div"); cover.className="cover-box";
        const img=document.createElement("img"); img.className="cover"; img.src=(p.photos&&p.photos[0])||""; cover.appendChild(img);
        const inner=document.createElement("div"); inner.className="inner";
        const title=document.createElement("div"); title.style.fontWeight="700"; title.textContent=`${p.title}`;
        const geo=document.createElement("div"); geo.className="muted"; geo.textContent=`${p.city} â€¢ ${p.district}`;
        const price=document.createElement("div"); price.style.fontWeight="800"; price.style.color="black";
        if(p.kind==="jardin"){ price.innerHTML=`<span style="color:var(--greenPure)">Service de paysagisme</span>` }
        else { price.innerHTML=`<span style="background:var(--greenBadgeBg);color:black;padding:2px 6px;border-radius:6px">${fmt(p.price)} FCFA</span>` }
        const btn=document.createElement("button"); btn.className="btn install"; btn.textContent="Voir"; btn.onclick=()=>openDetail(p);
        inner.appendChild(title); inner.appendChild(geo); inner.appendChild(price); inner.appendChild(btn);
        card.appendChild(cover); card.appendChild(inner); grid.appendChild(card);
      });
      empty.style.display=list.length?"none":"block";
    }

    // ==================== Carte avec pins orange ====================
    let map=null, layer=null;
    function initMap(){
      if(!map){ map=L.map('leaf').setView([7.5,-5],6); L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map); }
      if(layer){layer.remove()}
      const list=db_get(LS_LISTINGS,SAMPLE);
      const markers=list.map(p=>{
        const marker=L.marker([p.lat,p.lng],{
          icon:L.divIcon({html:`<div style="display:flex;align-items:center;gap:4px">
            <span style="width:12px;height:12px;border-radius:50%;background:var(--orange)"></span>
            <span style="background:var(--greenBadgeBg);color:black;padding:2px 6px;border-radius:6px">${p.kind==="jardin"?"Jardin":fmt(p.price)+" FCFA"}</span>
          </div>`})
        }).on("click",()=>openDetail(p));
        return marker;
      });
      layer=L.layerGroup(markers).addTo(map);
    }

    // ==================== DÃ©tail dâ€™une annonce ====================
    function openDetail(p){
      $("#m-title").textContent=p.title;
      $("#m-geo").textContent=`${p.city} â€¢ ${p.district}`;
      $("#m-price").textContent=p.kind==="jardin"?"Service paysagiste":fmt(p.price)+" FCFA";
      $("#m-desc").textContent=p.kind==="jardin"?"CrÃ©ation et entretien de jardins avec Les Fleurs dâ€™Eden":"Description de lâ€™annonce.";
      const btnDevis=$("#m-devis-wa");
      if(p.kind==="jardin"){ btnDevis.style.display="inline-block"; btnDevis.onclick=()=>{ window.open("https://wa.me/"+ADMIN_PAYSAGISTE_PHONE.replace(/[+ ]/g,""),"_blank"); }; }
      else { btnDevis.style.display="none"; }
      openModal("#modal");
    }

    function openModal(sel){const el=$(sel);if(el)el.classList.add("open")}
    function closeModal(sel){const el=$(sel);if(el)el.classList.remove("open")}

    // ==================== Bot flottant ====================
    (function(){
      const panel=$("#bot-panel"), button=$("#bot-button"), close=$("#bot-close"), body=$("#bot-body"), text=$("#bot-text"), send=$("#bot-send");
      function say(msg){ const d=document.createElement("div"); d.className="bot-msg"; d.innerHTML=`<div class="bubble">${msg}</div>`; body.appendChild(d); body.scrollTop=body.scrollHeight; }
      function handle(q){
        const t=q.toLowerCase();
        if(t.includes("jardin")||t.includes("paysagiste")){ say("ðŸŒ¿ Voici notre partenaire <b>Les Fleurs dâ€™Eden</b>.<br>ðŸ“ž "+ADMIN_PAYSAGISTE_PHONE+"<br>âœ‰ï¸ "+ADMIN_PAYSAGISTE_EMAIL); }
        else if(t.includes("maison")||t.includes("appartement")){ say("ðŸ  Clique sur Explorer pour voir les annonces disponibles."); }
        else if(t.includes("gps")||t.includes("carte")){ say("ðŸ“ Jâ€™ouvre la carte."); initMap(); $("#map").style.display="block"; }
        else if(t.includes("compte")||t.includes("inscription")){ say("ðŸ“ Clique sur Inscription pour crÃ©er ton compte."); }
        else { say("Je peux tâ€™aider : essaye Â« jardin Â», Â« maison Â», Â« GPS Â», Â« inscription Â»."); }
      }
      button.onclick=()=>{ panel.classList.toggle("open"); body.innerHTML=""; say("Bonjour ðŸ‘‹, besoin dâ€™un bien ou dâ€™un paysagiste ?"); };
      close.onclick=()=>panel.classList.remove("open");
      send.onclick=()=>{handle(text.value); text.value="";};
      text.onkeydown=e=>{if(e.key==="Enter"){e.preventDefault();send.click();}};
    })();

    // DÃ©marrage
    render();
  </script>
</body>
</html>
